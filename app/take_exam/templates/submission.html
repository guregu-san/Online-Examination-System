{% extends "base.html" %}
{% import "bootstrap/wtf.html" as wtf %}

{%block title%}Take Exam{%endblock%}

{%block main_content%}
<div class="card p-3"> 
  <h2 class="mb-2">{{ exam.title }}</h2>
  {% if exam.time_limit %}<p class="text-muted">Time limit: {{ exam.time_limit }} minutes</p>{% endif %}

  <form method="POST" action="">
    {{ form.hidden_tag() }}

    {# Show roll number from session (read-only) and include hidden input if available #}
    {% if session.get('roll_number') %}
      <div class="mb-3">
        <label class="form-label">Roll number</label>
        <input type="hidden" name="roll_number" value="{{ session.get('roll_number') }}">
        <div class="form-control-plaintext">{{ session.get('roll_number') }}</div>
      </div>
    {% endif %}

    {% for subform in form.questions %}
      <div class="mb-4 p-3 border rounded">
        <div class="mb-2"><strong>Question {{ loop.index }}:</strong></div>
        <div class="mb-2">{{ questions[loop.index0].question_text }}</div>

        {{ subform.question_id }}
        {{ subform.single_or_multi }}

        {% if subform.single_or_multi.data == 'multi' %}
          <div>
            {% for opt in subform.answer_multi %}
              <div class="form-check">
                {{ opt(class="form-check-input") }}
                <label class="form-check-label" for="{{ opt.id }}">{{ opt.label.text }}</label>
              </div>
            {% endfor %}
          </div>
        {% else %}
          <div>
            {% for opt in subform.answer_single %}
              <div class="form-check">
                {{ opt(class="form-check-input") }}
                <label class="form-check-label" for="{{ opt.id }}">{{ opt.label.text }}</label>
              </div>
            {% endfor %}
          </div>
        {% endif %}

        {% if subform.answer_single.errors %}
          <div class="text-danger mt-2">
            {% for e in subform.answer_single.errors %}{{ e }} {% endfor %}
          </div>
        {% endif %}
        {% if subform.answer_multi.errors %}
          <div class="text-danger mt-2">
            {% for e in subform.answer_multi.errors %}{{ e }} {% endfor %}
          </div>
        {% endif %}
      </div>
    {% endfor %}

    <div class="d-flex gap-2">
      {{ form.submit(class="btn btn-primary") }}
      <a href="{{ url_for('takeExamBp.exam_search') }}" class="btn btn-secondary">Save and Exit</a>
    </div>
  </form>
</div>
{%endblock%}
